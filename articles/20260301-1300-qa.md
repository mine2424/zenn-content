---
title: "テスト設計における「境界値」への向き合い方"
emoji: "🎯"
type: "tech"
topics: ["テスト", "qa", "品質保証", "テスト設計", "ソフトウェア品質"]
published: false
---

## はじめに

ソフトウェアのバグはどこに潜んでいるか。経験的に言えば、「端っこ」に多いです。ゼロと一、最大値と最大値プラス一、空文字列と一文字の文字列——境界線のすぐ近くに、バグは潜んでいます。

境界値分析は古くからあるテスト技法ですが、それを「なぜそこにバグが生まれやすいのか」という視点で理解することで、より深いテスト設計ができるようになります。この記事では、境界値への向き合い方を改めて整理します。

## バグが境界に集中する理由

ソフトウェアのコードは、条件分岐でできています。`if x > 0`、`if items.length >= 10`、`if name != ""`。これらの条件式は、値の「境界」を定義しています。

バグが境界に集中する主な理由は、人間の認知の特性にあります。

- **「以上」と「より大きい」を混同する**：`>=`を書くべきところを`>`と書いてしまう
- **ゼロや空を特別視し忘れる**：0件のリストや空文字列を通常処理に含めてしまう
- **境界の片側しかテストしない**：「大きすぎる場合」はテストするが「ぴったり上限の場合」を忘れる

これらは単純なミスに見えて、実は非常に頻繁に起きます。コードレビューで「ここ`>`じゃなくて`>=`じゃないですか?」という指摘は、どの現場でも聞こえてくる定番のものです。

## 境界値分析の基本

境界値分析の考え方はシンプルです。入力の範囲があれば、その境界とその直近を必ずテストする。

たとえば「年齢は1以上120以下の整数を受け付ける」という仕様があれば：

| テストケース | 値 | 期待する結果 |
|---|---|---|
| 下限未満 | 0 | エラー |
| 下限 | 1 | 正常 |
| 下限の内側 | 2 | 正常 |
| 上限の内側 | 119 | 正常 |
| 上限 | 120 | 正常 |
| 上限超過 | 121 | エラー |

「中間値（例えば60）をテストすれば十分」と思う人もいますが、それは等価クラス分析で正常系の代表値を一つ取ったに過ぎません。境界部分のテストは別途必要です。

## 見落としやすい境界

明示的な数値の境界だけでなく、以下のような「暗黙の境界」も忘れがちです。

### 空（ゼロ）の境界

- 空のリスト → ループが0回実行される
- 空文字列 → 文字列操作が失敗しやすい
- ゼロ → 除算でのゼロ除算、パーセンテージ計算の破綻

「空の場合」はコードパスが特別な分岐を通ることが多く、バグが潜みやすい境界です。

### 型の境界

整数型のオーバーフロー（int32の2,147,483,647）、浮動小数点数の精度の限界、文字列のエンコーディング境界（マルチバイト文字の末尾）なども、見落としやすい境界です。

### ビジネスロジックの境界

「送料無料は5,000円以上」「会員ランクの昇格は1,000ポイント到達時」といったビジネスルールも、プログラム上では境界を持ちます。4,999円と5,000円の両方をテストしているかどうか。

## 境界のドキュメント化という習慣

テスト設計をするとき、境界を明示的にリストアップする習慣を持つと良いです。

```
機能: カートの合計金額計算

境界値リスト:
- 商品数: 0件, 1件, 最大99件, 100件(上限), 101件
- 金額: 0円, 1円, 4999円, 5000円(送料無料境界), 5001円
- クーポン割引後: 0円以下にならないか
- 税込計算: 少数点以下の丸め処理は?
```

こうして境界を書き出すと、「そういえばクーポン使ったときにマイナスになる可能性は?」という新たな気づきが生まれます。境界値分析はバグを見つける技法であると同時に、仕様の抜け漏れを発見する技法でもあります。

## 自動テストと境界値

境界値テストは自動化と相性が良いです。パラメータ化テストを使うと、境界値をデータとして管理できます。

```typescript
describe("年齢バリデーション", () => {
  test.each([
    [0, false],
    [1, true],
    [2, true],
    [119, true],
    [120, true],
    [121, false],
  ])("age=%i のとき、valid=%s", (age, expected) => {
    expect(isValidAge(age)).toBe(expected);
  });
});
```

これにより、境界値のテストケースが明示的に記述され、仕様変更時も一目でどの境界を変えればいいかわかります。

## 探索的テストと組み合わせる

境界値分析は「事前に設計されたテスト」ですが、実際のバグはその設計で想定していない場所にも潜みます。

そこで有効なのが、探索的テストと組み合わせることです。

1. 境界値分析で「最低限このケースはカバーしている」という安心感を持つ
2. 探索的テストで「この境界を複数組み合わせたらどうか」を自由に試す

たとえば「空のカートに無効なクーポンを適用した場合」のように、複数の境界が重なる状況は、設計段階では見落としやすく、探索的テストで発見されることが多いです。

## おわりに

境界値分析は地味に見えますが、少ないテストケースで効率よくバグを発見できる、非常に実用的な技法です。

「なぜここがバグになったのか」を振り返ると、多くの場合「境界の扱いが甘かった」という結論に至ります。その認識を持ったうえで、テスト設計の際に意識的に境界をリストアップする習慣をつけること——それだけで、品質は着実に上がります。
